@page "{id:guid}"
@model TrafficLawDocumentRazor.Pages.LawDocumentPage.Management.EditModel

@{
    ViewData["Title"] = "Edit Document";
    var isExpert = User.IsInRole("Expert");
}

<h1>@(isExpert ? "Verify Document" : "Edit Document")</h1>
<p>@(isExpert ? "Verify law document." : "Edit law document details.")</p>

@if (isExpert)
{
    <form method="post" asp-page-handler="Verify" asp-route-id="@RouteData.Values["id"]">
        <input type="hidden" name="id" value="@RouteData.Values["id"]" />
        <div class="d-flex justify-content-end mt-4">
            <button type="submit" class="btn btn-dark btn-lg">Save</button>
        </div>
    </form>
}
else
{
    <form method="post">
        <input type="hidden" asp-for="LawDocument.LinkPath" />

        <div class="row" style="gap: 2rem;">
            <div class="col-md-6" style="border:2px dashed #c3b6fc; border-radius:12px; padding:2rem;">
                <div class="mb-3">
                    <label asp-for="LawDocument.Title" class="form-label">Title *</label>
                    <input asp-for="LawDocument.Title" class="form-control" />
                    <span asp-validation-for="LawDocument.Title" class="text-danger"></span>
                </div>
                <div class="mb-3">
                    <label asp-for="LawDocument.DocumentCode" class="form-label">Code *</label>
                    <input asp-for="LawDocument.DocumentCode" class="form-control" />
                    <span asp-validation-for="LawDocument.DocumentCode" class="text-danger"></span>
                </div>
                <div class="mb-3">
                    <label asp-for="LawDocument.CategoryId" class="form-label">Category *</label>
                    <select asp-for="LawDocument.CategoryId" class="form-select" asp-items="Model.Categories">
                        <option value="">Select Category</option>
                    </select>
                    <span asp-validation-for="LawDocument.CategoryId" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-5" style="border:2px dashed #c3b6fc; border-radius:12px; padding:2rem;">
                <label class="form-label">Tags *</label>
                <div class="d-flex flex-wrap gap-2">
                    @foreach (var tag in Model.Tags)
                    {
                        var isChecked = Model.LawDocument.TagList != null
                        && Model.LawDocument.TagList.Any(t => t.DocumentTagId.ToString() == tag.Value);
                        <div class="form-check form-check-inline">
                            <input class="btn-check"
                                   type="checkbox"
                                   name="SelectedTagIds"
                                   value="@tag.Value"
                                   id="tag-@tag.Value"
                                   @(isChecked ? "checked" : "") />
                            <label class="btn btn-outline-dark" for="tag-@tag.Value">@tag.Text</label>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-end mt-4">
            <button type="submit" class="btn btn-dark btn-lg">Save Document</button>
        </div>
    </form>
}

<div class="mt-3">
    <a asp-page="./Index">Back to List</a>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
